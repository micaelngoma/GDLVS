<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GDLVS - Access Request</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- i18n + jQuery -->
    <script src="https://unpkg.com/i18next@21.6.3/dist/umd/i18next.min.js"></script>
    <script src="https://unpkg.com/i18next-browser-languagedetector@6.1.2/i18nextBrowserLanguageDetector.min.js"></script>
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://unpkg.com/jquery-i18next@1.2.1/dist/umd/jquery-i18next.min.js"></script>

    <style>
      :root {
        --brand-dark: #004aad;
        --brand-dark-2: #003780;
        --blue: #004aad;
        --text: #333;
        --muted: #666;
        --shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }
      body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: #f6f8fb;
        color: var(--text);
        margin: 0;
        padding: 0;
      }
      .background {
        position: fixed;
        inset: 0;
        background: url("https://raw.githubusercontent.com/micaelngoma/GDLVS/main/Gabon%20Forest.jpg")
          no-repeat center center fixed;
        background-size: cover;
        z-index: -1;
        filter: brightness(0.85);
      }
      .container {
        max-width: 480px;
        margin: 70px auto;
        background: rgba(255, 255, 255, 0.97);
        border-radius: 10px;
        box-shadow: var(--shadow);
        padding: 30px 25px;
        text-align: center;
      }
      h2 {
        color: var(--brand-dark);
        margin-bottom: 20px;
      }
      input,
      textarea,
      select,
      button {
        width: 100%;
        padding: 10px;
        margin: 8px 0;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
      }
      button {
        background: var(--brand-dark);
        color: #fff;
        cursor: pointer;
        transition: 0.2s;
        border: none;
      }
      button:hover {
        background: var(--brand-dark-2);
      }
      a {
        color: var(--blue);
        font-weight: bold;
        text-decoration: none;
      }
      a:hover {
        text-decoration: underline;
      }
      footer {
        text-align: center;
        margin-top: 20px;
      }
      #msg {
        margin-top: 10px;
        color: green;
        font-weight: bold;
      }
    </style>
  </head>

  <body>
    <div class="background"></div>

    <div class="container">
      <h2 data-i18n="title">
        <i class="fa-solid fa-user-plus"></i> Access Request
      </h2>

      <form id="accessForm" onsubmit="submitAccessRequest(event)">
        <input
          id="fullName"
          placeholder="Full Name"
          data-i18n="[placeholder]fullName"
          required
        />
        <input
          type="email"
          id="email"
          placeholder="Email"
          data-i18n="[placeholder]email"
          required
        />
        <input
          id="organization"
          placeholder="Organization"
          data-i18n="[placeholder]organization"
          required
        />
        <input
          id="phone"
          placeholder="Phone Number"
          data-i18n="[placeholder]phone"
          required
        />

        <label for="country" style="display: block; text-align: left; margin-top: 5px"
          ><strong data-i18n="country">Country</strong></label
        >
        <select id="country" required></select>

        <textarea
          id="purpose"
          rows="3"
          placeholder="Purpose of Access"
          data-i18n="[placeholder]purpose"
          required
        ></textarea>

        <button type="submit">
          <i class="fas fa-paper-plane"></i>
          <span data-i18n="submit">Submit Request</span>
        </button>
      </form>

      <p id="msg"></p>

      <footer>
        <a href="index.html" data-i18n="backToLogin">‚Üê Back to Login</a>
        <br /><br />
        <label for="languageSwitcher"><i class="fas fa-globe"></i></label>
        <select id="languageSwitcher">
          <option value="en">üá¨üáß English</option>
          <option value="fr">üá´üá∑ Fran√ßais</option>
          <option value="ja">üáØüáµ Êó•Êú¨Ë™û</option>
        </select>
      </footer>
    </div>

    <script>
      /* === Firebase Configuration === */
      const firebaseConfig = {
        apiKey: "AIzaSyBiZN1G3ShoDOcPLe-bUILNf90NpdcCu6k",
        authDomain: "gdlvs-2348e.firebaseapp.com",
        projectId: "gdlvs-2348e",
        storageBucket: "gdlvs-2348e.appspot.com",
        messagingSenderId: "358715790318",
        appId: "1:358715790318:web:9d4c85e0f71222cf1b34ff",
      };
      if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      /* === EmailJS Configuration === */
      emailjs.init("TfmaZEvxtz2MNUb70");

      /* === Translations === */
      const i18nResources = {
        en: {
          translation: {
            title: "Access Request",
            fullName: "Full Name",
            email: "Email",
            organization: "Organization",
            phone: "Phone Number",
            purpose: "Purpose of Access",
            submit: "Submit Request",
            backToLogin: "‚Üê Back to Login",
            success:
              "‚úÖ Your request has been submitted successfully. A confirmation email has been sent.",
            country: "Country",
          },
        },
        fr: {
          translation: {
            title: "Demande d‚Äôacc√®s",
            fullName: "Nom complet",
            email: "Adresse e-mail",
            organization: "Organisation",
            phone: "T√©l√©phone",
            purpose: "Objet de la demande",
            submit: "Soumettre la demande",
            backToLogin: "‚Üê Retour √† la connexion",
            success:
              "‚úÖ Votre demande a √©t√© soumise avec succ√®s. Un e-mail de confirmation a √©t√© envoy√©.",
            country: "Pays",
          },
        },
        ja: {
          translation: {
            title: "„Ç¢„ÇØ„Çª„ÇπÁî≥Ë´ã",
            fullName: "Ê∞èÂêç",
            email: "„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ",
            organization: "ÁµÑÁπî",
            phone: "ÈõªË©±Áï™Âè∑",
            purpose: "„Ç¢„ÇØ„Çª„ÇπÁõÆÁöÑ",
            submit: "Áî≥Ë´ã„ÇíÈÄÅ‰ø°",
            backToLogin: "‚Üê „É≠„Ç∞„Ç§„É≥„Å´Êàª„Çã",
            success:
              "‚úÖ „É™„ÇØ„Ç®„Çπ„Éà„ÅåÊ≠£Â∏∏„Å´ÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„Åü„ÄÇÁ¢∫Ë™ç„É°„Éº„É´„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„Åü„ÄÇ",
            country: "ÂõΩ",
          },
        },
      };
      i18next
        .use(i18nextBrowserLanguageDetector)
        .init(
          { resources: i18nResources, fallbackLng: "en" },
          () => {
            jqueryI18next.init(i18next, $, { useOptionsAttr: true });
            $("body").localize();
          }
        );
      document
        .getElementById("languageSwitcher")
        .addEventListener("change", function () {
          i18next.changeLanguage(this.value, () => $("body").localize());
        });

      /* === Populate Country Dropdown === */
      const countries = [
        "Gabon",
        "United States",
        "France",
        "Japan",
        "China",
        "Brazil",
        "United Kingdom",
        "Canada",
        "Germany",
        "Nigeria",
        "South Africa",
        "India",
        "Mexico",
        "Spain",
        "Italy",
        "Australia",
        "Singapore",
        "Kenya",
        "Cameroon",
        "Morocco",
      ];
      const countrySelect = document.getElementById("country");
      countries.forEach((c) => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        countrySelect.appendChild(opt);
      });

      /* === Submit Access Request === */
      async function submitAccessRequest(event) {
        event.preventDefault();

        const name = document.getElementById("fullName").value.trim();
        const email = document.getElementById("email").value.trim();
        const organization = document.getElementById("organization").value.trim();
        const phone = document.getElementById("phone").value.trim();
        const purpose = document.getElementById("purpose").value.trim();
        const country = document.getElementById("country").value;

        if (!name || !email || !organization || !phone || !purpose || !country) {
          alert("‚ö†Ô∏è Please fill in all fields.");
          return;
        }

        try {
          await db.collection("requests").add({
            fullName: name,
            email,
            organization,
            phone,
            purpose,
            country,
            status: "pending",
            requestedAt: firebase.firestore.FieldValue.serverTimestamp(),
          });

          // Send EmailJS Notification (to requester + admin)
          await emailjs.send("service_ddq3kka", "template_inl3jsv", {
            name,
            email,
            organization,
            phone,
            purpose,
            country,
            status: "pending",
            message:
              "Your access request to the Gabon Driver‚Äôs License Verification System (GDLVS) has been received and is under review.",
          });

          document.getElementById("msg").innerText = i18next.t("success");
          document.getElementById("accessForm").reset();
        } catch (err) {
          console.error(err);
          alert("‚ùå Failed to submit request: " + err.message);
        }
      }

      window.submitAccessRequest = submitAccessRequest;
    </script>
  </body>
</html>
